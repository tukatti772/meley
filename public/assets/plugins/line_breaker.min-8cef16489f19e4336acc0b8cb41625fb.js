!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n)}:e(window.jQuery)}(function(e){e.extend(e.FE.DEFAULTS,{lineBreakerTags:["table","hr","form","dl","span.fr-video",".fr-embedly",".fr-img-caption"],lineBreakerOffset:15,lineBreakerHorizontalOffset:10}),e.FE.PLUGINS.lineBreaker=function(t){function n(e,n){var r,a,o,i,s,f,l,p;if(null==e)i=n.parent(),s=i.offset().top,l=n.offset().top,r=l-Math.min((l-s)/2,t.opts.lineBreakerOffset),o=i.outerWidth(),a=i.offset().left;else if(null==n)i=e.parent(),f=i.offset().top+i.outerHeight(),p=e.offset().top+e.outerHeight(),r=p+Math.min((f-p)/2,t.opts.lineBreakerOffset),o=i.outerWidth(),a=i.offset().left;else{i=e.parent();var u=e.offset().top+e.height(),d=n.offset().top;if(u>d)return!1;r=(u+d)/2,o=i.outerWidth(),a=i.offset().left}t.opts.iframe&&(a+=t.$iframe.offset().left-t.helpers.scrollLeft(),r+=t.$iframe.offset().top-t.helpers.scrollTop()),t.$box.append(b),b.css("top",r-t.win.pageYOffset),b.css("left",a-t.win.pageXOffset),b.css("width",o),b.data("tag1",e),b.data("tag2",n),b.addClass("fr-visible").data("instance",t)}function r(e,r){var o,i,s=e.offset().top,f=e.offset().top+e.outerHeight();if(Math.abs(f-r)<=t.opts.lineBreakerOffset||Math.abs(r-s)<=t.opts.lineBreakerOffset)if(Math.abs(f-r)<Math.abs(r-s)){i=e.get(0);for(var l=i.nextSibling;l&&l.nodeType==Node.TEXT_NODE&&0===l.textContent.length;)l=l.nextSibling;if(!l)return n(e,null),!0;if(o=a(l))return n(e,o),!0}else{if(i=e.get(0),!i.previousSibling)return n(null,e),!0;if(o=a(i.previousSibling))return n(o,e),!0}b.removeClass("fr-visible").removeData("instance")}function a(n){if(n){var r=e(n);if(0===t.$el.find(r).length)return null;if(n.nodeType!=Node.TEXT_NODE&&r.is(t.opts.lineBreakerTags.join(",")))return r;if(r.parents(t.opts.lineBreakerTags.join(",")).length>0)return n=r.parents(t.opts.lineBreakerTags.join(",")).get(0),0!==t.$el.find(n).length&&e(n).is(t.opts.lineBreakerTags.join(","))?e(n):null}return null}function o(e){if(void 0!==e.inFroalaWrapper)return e.inFroalaWrapper;for(var n=e;e.parentNode&&e.parentNode!==t.$wp.get(0);)e=e.parentNode;return n.inFroalaWrapper=e.parentNode==t.$wp.get(0),n.inFroalaWrapper}function i(e,n){var r=t.doc.elementFromPoint(e,n);return r&&!r.closest(".fr-line-breaker")&&!t.node.isElement(r)&&r!=t.$wp.get(0)&&o(r)?r:null}function s(e,n,r){for(var a=r,o=null;a<=t.opts.lineBreakerOffset&&!o;)o=i(e,n-a),o||(o=i(e,n+a)),a+=r;return o}function f(e,n,r){for(var a=null,o=100;!a&&e>t.$box.offset().left&&e<t.$box.offset().left+t.$box.outerWidth()&&o>0;)a=i(e,n),a||(a=s(e,n,5)),"left"==r?e-=t.opts.lineBreakerHorizontalOffset:e+=t.opts.lineBreakerHorizontalOffset,o-=t.opts.lineBreakerHorizontalOffset;return a}function l(e){w=null;var n=null,o=null,i=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset);i&&("HTML"==i.tagName||"BODY"==i.tagName||t.node.isElement(i)||(i.getAttribute("class")||"").indexOf("fr-line-breaker")>=0)?(o=s(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset,1),o||(o=f(e.pageX-t.win.pageXOffset-t.opts.lineBreakerHorizontalOffset,e.pageY-t.win.pageYOffset,"left")),o||(o=f(e.pageX-t.win.pageXOffset+t.opts.lineBreakerHorizontalOffset,e.pageY-t.win.pageYOffset,"right")),n=a(o)):n=a(i),n?r(n,e.pageY):t.core.sameInstance(b)&&b.removeClass("fr-visible").removeData("instance")}function p(e){return!(b.hasClass("fr-visible")&&!t.core.sameInstance(b))&&(t.popups.areVisible()||t.el.querySelector(".fr-selected-cell")?(b.removeClass("fr-visible"),!0):void(!1!==h||t.edit.isDisabled()||(w&&clearTimeout(w),w=setTimeout(l,30,e))))}function u(){w&&clearTimeout(w),b.hasClass("fr-visible")&&b.removeClass("fr-visible").removeData("instance")}function d(){h=!0,u()}function g(){h=!1}function c(n){if(!t.core.sameInstance(b))return!0;n.preventDefault(),b.removeClass("fr-visible").removeData("instance");var r=b.data("tag1"),a=b.data("tag2"),o=t.html.defaultTag();null==r?o&&"TD"!=a.parent().get(0).tagName&&0===a.parents(o).length?a.before("<"+o+">"+e.FE.MARKERS+"<br></"+o+">"):a.before(e.FE.MARKERS+"<br>"):o&&"TD"!=r.parent().get(0).tagName&&0===r.parents(o).length?r.after("<"+o+">"+e.FE.MARKERS+"<br></"+o+">"):r.after(e.FE.MARKERS+"<br>"),t.selection.restore()}function v(){t.shared.$line_breaker||(t.shared.$line_breaker=e('<div class="fr-line-breaker"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+t.language.translate("Break")+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect x="21" y="11" width="2" height="8"/><rect x="14" y="17" width="7" height="2"/><path d="M14.000,14.000 L14.000,22.013 L9.000,18.031 L14.000,14.000 Z"/></svg></a></div>')),b=t.shared.$line_breaker,t.events.on("shared.destroy",function(){b.html("").removeData().remove(),b=null},!0),t.events.on("destroy",function(){b.removeData("instance").removeClass("fr-visible").appendTo("body:first"),clearTimeout(w)},!0),t.events.$on(b,"mousemove",function(e){e.stopPropagation()},!0),t.events.bindClick(b,"a",c)}function m(){if(!t.$wp)return!1;v(),h=!1,t.events.$on(t.$win,"mousemove",p),t.events.$on(e(t.win),"scroll",u),t.events.on("popups.show.table.edit",u),t.events.on("commands.after",u),t.events.$on(e(t.win),"mousedown",d),t.events.$on(e(t.win),"mouseup",g)}var b,h,w;return{_init:m}}});